# 玩家狀態顯示改進

## 更新內容

改進了遊戲狀態面板的視覺效果，讓玩家更清楚知道當前的遊戲狀態。

## 狀態類型

### 1. 🎮 正在遊玩中 (綠色，帶發光動畫)

**顯示條件**: 當您擁有控制權時

**顯示內容**:
```
🎮 正在遊玩中
[您的使用者名稱]
✨ 您擁有控制權！
按下 W/A/S/D/Space 控制夾公仔機
⏰ 閒置超過 1 分鐘將自動釋放控制權
```

**視覺效果**:
- 綠色漸層背景
- 3px 綠色邊框
- 綠色發光動畫 (pulse)
- 大字體顯示您的名稱

### 2. ⏳ 正在排隊等待 (黃色)

**顯示條件**: 當您在等待隊列中時

**顯示內容**:
```
⏳ 正在排隊等待
🎮 當前遊玩者
[正在遊玩的玩家名稱]
📍 您的排隊位置: 第 X 位
⏰ 等待前方玩家完成或超時
```

**視覺效果**:
- 黃色漸層背景
- 3px 黃色邊框
- 藍色字體顯示當前玩家名稱
- 清楚標示您的排隊位置

### 3. 👀 觀看模式 (灰色，附排隊按鈕)

**顯示條件**: 當有人在玩，但您不在排隊時

**顯示內容**:
```
👀 觀看模式
🎮 當前遊玩者
[正在遊玩的玩家名稱]
💡 點擊下方按鈕加入排隊

[加入排隊] 按鈕
```

**視覺效果**:
- 灰色背景
- 2px 灰色邊框
- 藍色漸層按鈕
- 滑鼠懸停時按鈕上移動畫

**注意**: 目前系統是自動加入排隊，所以這個狀態可能不會出現。保留此設計以備未來擴展。

### 4. 🔄 連線中 (藍色)

**顯示條件**: WebSocket 正在連接時

**顯示內容**:
```
🔄 連線中...
正在連接到遊戲伺服器
```

**視覺效果**:
- 藍色背景
- 2px 藍色邊框

## UI 組件

### 玩家狀態容器
```css
#player-status-container {
  background: rgba(255, 255, 255, 0.03);
  border-radius: 10px;
  padding: 15px;
}
```

### 狀態框
```css
.player-status {
  padding: 15px;
  border-radius: 8px;
  text-align: center;
  transition: all 0.3s ease;
}
```

### 排隊按鈕
```css
.queue-button {
  width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, #3b82f6, #2563eb);
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}
```

## 動畫效果

### 綠色發光動畫 (當您在遊玩時)
```css
@keyframes pulse-green {
  0%, 100% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.3); }
  50% { box-shadow: 0 0 30px rgba(34, 197, 94, 0.6); }
}
```

### 按鈕懸停動畫
- 滑鼠懸停時向上移動 2px
- 陰影增強
- 漸層背景變深

## JavaScript 函數

### `updatePlayerStatus(statusData)`

**參數**:
```javascript
{
  canPlay: true/false,           // 是否可以遊玩
  queuePosition: 0,              // 排隊位置 (0-based)
  currentPlayer: 'username',     // 當前玩家名稱
  waitingCount: 3                // 等待人數
}
```

**功能**:
1. 根據 `statusData` 判斷顯示哪種狀態
2. 更新狀態框的類別和內容
3. 顯示或隱藏排隊按鈕
4. 獲取並顯示當前使用者名稱

## 後端改進

### `broadcastPlayerStatus()` 函數

現在會發送個別化的狀態給每個玩家：

**給當前玩家**:
```javascript
{
  type: 'player_status',
  canPlay: true,
  currentPlayer: 'alice',
  waitingCount: 2
}
```

**給排隊玩家**:
```javascript
{
  type: 'player_status',
  canPlay: false,
  queuePosition: 0,        // 第 1 位
  currentPlayer: 'alice',
  waitingCount: 2
}
```

## 使用情境範例

### 情境 1: Alice 第一個連線
1. Alice 連線到遊戲
2. 自動獲得控制權
3. 看到:
   ```
   🎮 正在遊玩中
   Alice
   ✨ 您擁有控制權！
   ```
4. 狀態框是綠色，帶發光動畫

### 情境 2: Bob 第二個連線
1. Bob 連線到遊戲 (Alice 正在玩)
2. 自動加入排隊，位置第 1 位
3. 看到:
   ```
   ⏳ 正在排隊等待
   🎮 當前遊玩者
   Alice
   📍 您的排隊位置: 第 1 位
   ```
4. 狀態框是黃色

### 情境 3: Charlie 第三個連線
1. Charlie 連線到遊戲 (Alice 玩，Bob 排第 1 位)
2. 自動加入排隊，位置第 2 位
3. 看到:
   ```
   ⏳ 正在排隊等待
   🎮 當前遊玩者
   Alice
   📍 您的排隊位置: 第 2 位
   ```

### 情境 4: Alice 超時/離開
1. Alice 1 分鐘沒操作或離開
2. Bob 自動獲得控制權
3. Bob 的顯示立即更新為:
   ```
   🎮 正在遊玩中
   Bob
   ✨ 您擁有控制權！
   ```
4. Charlie 的顯示更新為:
   ```
   ⏳ 正在排隊等待
   🎮 當前遊玩者
   Bob
   📍 您的排隊位置: 第 1 位
   ```

## 顏色設計

| 狀態 | 主色 | 邊框 | 文字 | 效果 |
|------|------|------|------|------|
| 正在遊玩 | #22c55e (綠) | 3px 實線 | #22c55e | 發光動畫 |
| 排隊等待 | #fbbf24 (黃) | 3px 實線 | #fbbf24 | 無 |
| 觀看模式 | #9ca3af (灰) | 2px 實線 | #9ca3af | 無 |
| 連線中 | #60a5fa (藍) | 2px 實線 | #60a5fa | 無 |

## 響應式設計

目前的設計在桌面端和移動端都能正常顯示。狀態框會隨著容器大小自動調整。

## 未來改進建議

- [ ] 顯示當前玩家的遊玩時間
- [ ] 顯示預估等待時間
- [ ] 增加音效提示 (輪到您時)
- [ ] 增加「讓出控制權」按鈕
- [ ] 顯示排隊人數的頭像列表
- [ ] 增加排隊進度條

## 測試檢查清單

- [x] 第一位玩家看到綠色「正在遊玩中」
- [x] 顯示玩家自己的使用者名稱
- [x] 第二位玩家看到黃色「正在排隊等待」
- [x] 顯示當前遊玩者的名稱
- [x] 顯示正確的排隊位置
- [x] 控制權轉移時狀態即時更新
- [x] 綠色狀態有發光動畫效果
- [x] 文字清晰易讀，排版美觀
